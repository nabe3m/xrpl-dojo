---
title: トラストラインの設定 | JavaScriptでのXRPL開発 三段編
description: JavaScriptでのXRPL開発 三段編として、クロスカレンシー送金を行うためのトラストラインの設定について解説しているページです。
sidebar:
  label: トラストラインの設定
  order: 5
---

import { Aside, Steps } from '@astrojs/starlight/components';

トラストラインを設定することで、特定の通貨を受け取ることができるようになります。

このガイドでは、発行者Aの`USD`を`A.USD`、発行者Bの`USD`を`B.USD`と表現します。

この例では、`Alice`と`Charlie`が`A.USD`を受け取り、`Bob`と`Daniel`が`B.USD`を受け取れることにしようと思いますので、以下のようにコードを設定します。

## 使用するメソッド

この章では、先ほどの章で作成した以下のメソッドを利用します。

```javascript
// utils/trustSet.js

// トラストラインを設定する関数
export async function setTrustLine(client, wallet, currency, issuer, limit) {
  try {
    const trustSet = {
      TransactionType: 'TrustSet',
      Account: wallet.classicAddress,
      LimitAmount: {
        currency: currency,
        issuer: issuer,
        value: limit,
      },
    };
    const response = await client.submitAndWait(trustSet, { wallet });
    console.log(`Trust line set for ${wallet.classicAddress}:`, response);
    return response;
  } catch (error) {
    console.error(
      `Error setting trust line for ${wallet.classicAddress}: ${error}`
    );
    throw error;
  }
}

```

## スクリプトの作成

<Steps>

1. プロジェクトディレクトリに`setTrustline.js`という新しいファイルを作成します。
2. 以下のコードを`setTrustline.js`に貼り付けます。

    ```javascript
    // setTrustline.js
    import { Client, Wallet, AccountSetAsfFlags } from 'xrpl';
    import { setTrustLine } from './utils/trustSet.js';
    import { setAccountFlags } from './utils/setAccountFlags.js';

    const client = new Client('wss://s.altnet.rippletest.net:51233'); // テストネットを使用

    async function main() {
        try {
            await client.connect();

            const issuerA = Wallet.fromSeed('s████████████████████████████');
            const issuerB = Wallet.fromSeed('s████████████████████████████');

            // Ripplingを許可する
            await setAccountFlags(client, issuerA, AccountSetAsfFlags.asfDefaultRipple);
            await setAccountFlags(client, issuerB, AccountSetAsfFlags.asfDefaultRipple);

            const alice = Wallet.fromSeed('s████████████████████████████');
            const bob = Wallet.fromSeed('s████████████████████████████');
            const charlie = Wallet.fromSeed('s████████████████████████████');
            const daniel = Wallet.fromSeed('s████████████████████████████');

            // AliceがissuerAのUSDを受け取るためのトラストラインを設定
            await setTrustLine(client, alice, 'USD', issuerA.classicAddress, '1000');

            // BobがissuerBのUSDを受け取るための信頼線を設定
            await setTrustLine(client, bob, 'USD', issuerB.classicAddress, '1000');

            // CharlieがissuerAのUSDを受け取るための信頼線を設定
            await setTrustLine(client, charlie, 'USD', issuerA.classicAddress, '1000');

            // DanielがissuerBのUSDを受け取るための信頼線を設定
            await setTrustLine(client, daniel, 'USD', issuerB.classicAddress, '1000');
        } catch (error) {
            console.error(`Error in trust line setup: ${error}`);
        } finally {
            await client.disconnect();
        }
    }

    main();
    ```

</Steps>


## スクリプトの実行

<Steps>

1. コマンドラインで以下のコマンドを実行して、スクリプトを実行します。

    ```bash
    node setTrustLine.js
    ```

2. 成功すれば、コンソールに以下が表示されます。
    ```bash
    Account flags set for rGViRHtm2o1hGKdL8RCsWiSKDi4SdBMYF4: {
    id: 12,
    result: {
        Account: 'rGViRHtm2o1hGKdL8RCsWiSKDi4SdBMYF4',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870615,
        Sequence: 869983,
        SetFlag: 8,
        SigningPubKey: 'EDA93EBB6F8645837929A4415A110713C3C46187580F6315E75828C785EB4233A5',
        TransactionType: 'AccountSet',
        TxnSignature: '8058EBA57C071B86F13F0F3A7B82B673AA5DBC1A639813891E6AF209B3F4688EAAC73E8ACCCA6E6782F643074AED9A0272DD27C66A56846AC3D327FE91251606',
        ctid: 'C00D48C500530001',
        date: 769652370,
        hash: 'E02C2242336A9CADAFAC36DEE50F42F101FC199E7DD20C678C21F091C5E5A14B',
        inLedger: 870597,
        ledger_index: 870597,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 83,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    Account flags set for rfFT1m96PbM4LuXuT6hRQoR35WJgEYELAE: {
    id: 24,
    result: {
        Account: 'rfFT1m96PbM4LuXuT6hRQoR35WJgEYELAE',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870617,
        Sequence: 869985,
        SetFlag: 8,
        SigningPubKey: 'ED09AFDD13CC9D9440559FFDB00B46B2AC54313280BEE01A1CD5AD5DAEEFC0E632',
        TransactionType: 'AccountSet',
        TxnSignature: '60BE0A825BADB8FA3349449810FA3C466AA7F3C9E70BDF9CA9AFE2D6D6AD3DBB987DC2397A9F864067115D9F1CAF5F48799C5593B2DF6B1F77E3A0E92571EA0D',
        ctid: 'C00D48C700000001',
        date: 769652372,
        hash: '85A724216D48672DBB1B76AE0EE6B4D928E1FF00FE236B483E707606D9AEB539',
        inLedger: 870599,
        ledger_index: 870599,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 0,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    Trust line set for rKrcBu6GJ68Kqz7tBH1wZtDtaLQw24G3nw: {
    id: 34,
    result: {
        Account: 'rKrcBu6GJ68Kqz7tBH1wZtDtaLQw24G3nw',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870619,
        LimitAmount: {
        currency: 'USD',
        issuer: 'rGViRHtm2o1hGKdL8RCsWiSKDi4SdBMYF4',
        value: '1000'
        },
        Sequence: 870041,
        SigningPubKey: 'EDA6FF04AA46A81C42E1BD6AEC2B89FA3A268E4AF9941E6A9EC178B67CBE5B22DA',
        TransactionType: 'TrustSet',
        TxnSignature: 'F9E20E3295DD7D4FD4527B80A0E2610003C9F6692DBEBA906EA96262A146D75D80AD58FA4CA83385DBCC91CF51104DB456262C3FF37B6812487C2E7DA85B6702',
        ctid: 'C00D48C9002F0001',
        date: 769652381,
        hash: '49EA3B24092C2D7CDFE9A640F74C5ABFB43F4AFF3BCE36A7AC507B0A76B95FAD',
        inLedger: 870601,
        ledger_index: 870601,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 47,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    Trust line set for r6q4Noj4eXuhi6CjSiV1rdtpN9YtaiMJz: {
    id: 49,
    result: {
        Account: 'r6q4Noj4eXuhi6CjSiV1rdtpN9YtaiMJz',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870621,
        LimitAmount: {
        currency: 'USD',
        issuer: 'rfFT1m96PbM4LuXuT6hRQoR35WJgEYELAE',
        value: '1000'
        },
        Sequence: 870042,
        SigningPubKey: 'EDBF8BBD0944BEC8BA8C2A7FBFD7B00CEF0DEA4FDF7984C20A2193B0D95F8855FE',
        TransactionType: 'TrustSet',
        TxnSignature: '3D7305BC491BDA8FC625A7E80F4BBED1D68A068C75C53A9D014EF0985B729A46A5C2C69E5D4A4A16BD60ADAF48A3DBBB43B64171303EC441AD9467EB7AC3D907',
        ctid: 'C00D48CB00000001',
        date: 769652390,
        hash: '49EFE19146F1743FA02852F361FCE0EAA5596677692872D2A683266D946FD527',
        inLedger: 870603,
        ledger_index: 870603,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 0,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    Trust line set for rLTMrJYzd4moEiafmvakeBMtspqSHn3AQ1: {
    id: 61,
    result: {
        Account: 'rLTMrJYzd4moEiafmvakeBMtspqSHn3AQ1',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870623,
        LimitAmount: {
        currency: 'USD',
        issuer: 'rGViRHtm2o1hGKdL8RCsWiSKDi4SdBMYF4',
        value: '1000'
        },
        Sequence: 870048,
        SigningPubKey: 'ED58424CB3AE6543EE356CE1D6BC54038246B7DCC6407303F2A7A6A96CA5259AC7',
        TransactionType: 'TrustSet',
        TxnSignature: '12569DBA0C513E57AF4F5FE30B4D31E570280E0E1DBB7F1750A5E3E966CAD158BCFFBDA4B43BFC91147ADBA589DA95922D918ABAB687E27E6BFC882E0011B102',
        ctid: 'C00D48CD00520001',
        date: 769652392,
        hash: 'F96E3B14DB2B993425931D93F74FC4DB4D0343F3D79A6696647EF3B5151628C5',
        inLedger: 870605,
        ledger_index: 870605,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 82,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    Trust line set for r3gY9Vx5LXDioruniEPZKav2fuSvCptDuD: {
    id: 73,
    result: {
        Account: 'r3gY9Vx5LXDioruniEPZKav2fuSvCptDuD',
        Fee: '12',
        Flags: 0,
        LastLedgerSequence: 870625,
        LimitAmount: {
        currency: 'USD',
        issuer: 'rfFT1m96PbM4LuXuT6hRQoR35WJgEYELAE',
        value: '1000'
        },
        Sequence: 870050,
        SigningPubKey: 'ED19241D79B405EE139F9E9B93AB0E50C1BE6D320AD666F6C16E6AABFBFD314EB6',
        TransactionType: 'TrustSet',
        TxnSignature: 'FED413F9E946F1E9BBC90A98340A6E1B0000ADB75232E151D3122AC71F3B755C05BB309E56308728CA2D889886E646732580F64461CDA80377998C4CCDF79905',
        ctid: 'C00D48CF00000001',
        date: 769652401,
        hash: '125D0E37EC777390725AA3777756BB8A63818CED736E870FF853FA895881A6B7',
        inLedger: 870607,
        ledger_index: 870607,
        meta: {
        AffectedNodes: [Array],
        TransactionIndex: 0,
        TransactionResult: 'tesSUCCESS'
        },
        validated: true
    },
    type: 'response'
    }
    ```
</Steps>

※次の章は作成中です。（2024/05/22）